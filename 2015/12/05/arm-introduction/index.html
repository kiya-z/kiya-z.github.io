<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <title> Arm 架构简介 · kiya </title>
    <meta charset="UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=edge" />
<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1"/>


<link rel="stylesheet" href="/style/style.css">
<script src="/script/jquery.min.js"></script>
<script>
    var CONFIG = {
        title: "kiya",
        author: "kiya",
        lightbox: true,
        animate: true
    }
</script>



    <link rel="stylesheet" href="/lightbox/css/lightbox.min.css">




    <link rel="stylesheet" href="/syuanpi/syuanpi.min.css">




    <link rel="icon" href="https://dn-coding-net-production-pp.qbox.me/159e486a-e407-4f88-8289-1ff286338478.png">







</head>
<body>
    <div class="progress">
    <div class="progress-inner"></div>
</div>
    <div class="body">
    <div class="tagcloud" id="tagcloud">
    <div class="tagcloud-inner">
        <a href="/tags/CTF/" style="font-size: 14px;">CTF</a> <a href="/tags/MSC/" style="font-size: 14px;">MSC</a> <a href="/tags/Python/" style="font-size: 14px;">Python</a> <a href="/tags/Xposed/" style="font-size: 14px;">Xposed</a> <a href="/tags/anti-debug/" style="font-size: 14px;">anti-debug</a> <a href="/tags/arm/" style="font-size: 14px;">arm</a> <a href="/tags/compile/" style="font-size: 14px;">compile</a> <a href="/tags/dalvik/" style="font-size: 14px;">dalvik</a> <a href="/tags/debug/" style="font-size: 14px;">debug</a> <a href="/tags/dex/" style="font-size: 14px;">dex</a> <a href="/tags/enforce/" style="font-size: 14px;">enforce</a> <a href="/tags/hook/" style="font-size: 14px;">hook</a> <a href="/tags/ida/" style="font-size: 14px;">ida</a> <a href="/tags/instruction/" style="font-size: 14px;">instruction</a> <a href="/tags/ndk/" style="font-size: 14px;">ndk</a> <a href="/tags/reverse/" style="font-size: 14px;">reverse</a> <a href="/tags/reversing/" style="font-size: 14px;">reversing</a> <a href="/tags/smali/" style="font-size: 14px;">smali</a> <a href="/tags/tools/" style="font-size: 14px;">tools</a> <a href="/tags/translation/" style="font-size: 14px;">translation</a>
    </div>
</div>
    <header class="header" id="header">
    <div class="title syuanpi tvIn">
    <div class="table">
        <div class="connect">
            <div class="connect-inner">
                <span><a href="/">kiya</a></span>
                
                    <span id="subtitle">世界は今日も平和ですねー</span>
                
            </div>
        </div>
    </div>
</div>
    <nav class="main-nav syuanpi tvIn">
<div class="table">

    <ul class="menu">
        
        
        
            <li class="menu-item">
                <a href="/">
                    <span>文章</span>
                    
                        <span class="menu-item-label">article</span>
                    
                </a>
            </li>
        
        
        
            <li class="menu-item">
                <a href="/archives">
                    <span>归档</span>
                    
                        <span class="menu-item-label">archives</span>
                    
                </a>
            </li>
        
        
        
            <li class="menu-item">
                <a href="javascript:;" id="tags">
                    <span>标签</span>
                    
                        <span class="menu-item-label">tags</span>
                    
                </a>
            </li>
        
        
        
            <li class="menu-item">
                <a href="/about">
                    <span>关于</span>
                    
                        <span class="menu-item-label">about</span>
                    
                </a>
            </li>
        
        
        
            <li class="menu-item">
                <a href="/atom.xml">
                    <span>订阅</span>
                    
                        <span class="menu-item-label">RSS</span>
                    
                </a>
            </li>
        
        
    </ul>

</div>
</nav>
<div class="mobile-nav"></div>
</header>
    <div class="container">
        <main class="main" id="main">
            
    
    <article class="post">
        <header class="post-header">
            <div class="post-time syuanpi riseIn-light back-1">
                <span>2015年12月5日</span>
            </div>
            <h1 class="post-title syuanpi riseIn-light back-2">
            
                Arm 架构简介
            
            </h1>
            
                
                    <div class="post-tags syuanpi riseIn-light back-3">
                    
                        <a href="/tags/arm/">arm</a>
                    
                    </div>
                
            
        </header>
        <div class="post-content syuanpi riseIn-light back-3">
            
                <p>原书链接: <a href="https://www.scss.tcd.ie/~waldroj/3d1/arm_arm.pdf" target="_blank" rel="external">https://www.scss.tcd.ie/~waldroj/3d1/arm_arm.pdf</a></p>
<p>本文原文: “A1.1 About the ARM architecture”</p>
<a id="more"></a>
<h1 id="A1-1-关于ARM-架构"><a href="#A1-1-关于ARM-架构" class="headerlink" title="A1.1 关于ARM 架构"></a>A1.1 关于ARM 架构</h1><p>ARM 架构已经可以支持高低各种性能的实现. 超过20亿设备装备了ARM,确立了其在市场上统治意义的地位. ARM 处理器的简单架构可以实现各种小功能同时电量消耗低. 在 ARM 架构的发展中,实现难度,性能,电量消耗低都是不可或缺的关键因素.</p>
<p>ARM 是精简指令集,典型特征如下:</p>
<ul>
<li>统一样式的寄存器文件</li>
<li>load/store 架构,数据处理指令只能处理寄存器中的内容,不能直接处理内存中的内容</li>
<li>简单的寻址模式,load/store的地址只由寄存器内容和指令字段决定</li>
<li>统一固定长度的指令字段,可简化指令解析</li>
</ul>
<p>除此之外,ARM架构还提供:</p>
<ul>
<li>大多数数据处理指令都可以控制ALU和移位器,这样可以最大化利用ALU和移位器</li>
<li>自增自减寻址模式,优化循环</li>
<li>load/store多条指令合一,增加数据吞吐量</li>
<li>所有指令的条件执行,增加执行吞吐量</li>
</ul>
<p>这些对于RISC的增强功能使得ARM处理器在高性能,代码少,低消耗和芯片面积小之间达到了良好的平衡.</p>
<h1 id="A1-1-1-ARM-寄存器"><a href="#A1-1-1-ARM-寄存器" class="headerlink" title="A1.1.1  ARM 寄存器"></a>A1.1.1  ARM 寄存器</h1><p>ARM有31个32位通用寄存器,任何时候其中16个都是可见的,其他寄存器是用来加速异常处理的.<br>非特权代码使用着这16个寄存器,也就是处于用户模式的代码.<br>用户模式的特点如下:</p>
<ul>
<li>用户模式只能产生异常切换到另一个进程中.在编程层面由SWI指令实现这一功能.</li>
<li>相对于特权模式,用户模式能访问到的内存和协处理器功能是有限的.</li>
</ul>
<p>在这16个寄存器当中,有三个是特殊寄存器:<br><strong>Stack pointer</strong>: R13是栈顶指针(SP). 在T变种指令集中R13被PUSH和POP使用,从ARMv6之后被SRS和RFE指令使用.</p>
<p><strong>Link register</strong>: R14是链接寄存器(LR),在执行BL和BLX指令时,存放下一条指令的地址(即子程序的返回地址). 在异常模式的入口处页作为返回地址使用. 其余情况作为通用寄存器使用.</p>
<p><strong>Program counter</strong>: R15是程序计数器(PC). 指向当前正在执行指令的下一条的下一条指令的地址. 在ARM中,所有的指令都是4字节长(一个32位字),并且以一个字长对齐. 这就意味着PC的后两位总是0,也就是只有30位是有用的. 有些架构版本给剩余的两位赋予了含义. T变种和J变种的Jazelle状态支持Thumb指令集,此时PC大小为16位,以1字节对齐.</p>
<p>其余的13个寄存器没有特殊的硬件指定的用途,只会被软件指定使用.</p>
<h1 id="A1-1-2-异常"><a href="#A1-1-2-异常" class="headerlink" title="A1.1.2 异常"></a>A1.1.2 异常</h1><p>ARM支持7种类型的异常,每种异常都可进入特权处理模式.<br>这7种异常是:</p>
<ul>
<li>重置</li>
<li>试图执行未定义指令</li>
<li>软件中断指令(SWI),可以用来调用操作系统</li>
<li>预取中止,中止读内存指令</li>
<li>数据中止,数据访问权限中止</li>
<li>IRQ,正常中断</li>
<li>FIQ,快速中断</li>
</ul>
<p>异常发生时,一些标准寄存器将被异常模式征用. 所有的异常都有R13,R14的替代寄存器,快速中断异常模式还有其他的替代寄存器.</p>
<p>进入异常的handler时,R14存放异常处理的返回地址,用来返回到造成异常的代码.</p>
<p>在整个异常处理过程中,R13是每个handler的独立的stack pointer. 快速中断模式会将R8-R12的值存起来,这样中断处理程序在开始之前就不用存储或者恢复这些寄存器了.</p>
<p>第六特权处理模式-系统模式,可以使用用户模式的寄存器. 此功能用来运行需要内存或协处理器高级权限的任务,并且没有对异常发生的限制.</p>
<p>除了上面这些,reset和SWIs共享同等特权模式.</p>
<h2 id="异常处理过程"><a href="#异常处理过程" class="headerlink" title="异常处理过程"></a>异常处理过程</h2><p>异常发生时, ARM 处理器以一种预定义的方式暂停执行, 开始执行内存中某一固定地址处的异常向量代码. 包括reset在内每个异常都有一个异常向量地址. 正常运行的系统和调试事件对应的行为都是定义好的.</p>
<p>操作系统在初始化时为每个异常分配一个handler, 有权限的系统任务运行在系统模式下可以让操作系统内不带状态损失的发生异常.</p>
<h1 id="A1-1-3-状态寄存器"><a href="#A1-1-3-状态寄存器" class="headerlink" title="A1.1.3 状态寄存器"></a>A1.1.3 状态寄存器</h1><p>除了通用寄存器的内容之外,所有的处理器状态保存在状态寄存器中. 当前的操作系统状态保存在CPSR寄存器中(Current Program Status Register). 内容如下:</p>
<ul>
<li>4个条件标记位(负数,0,进位,溢出)</li>
<li>1个sticky(Q)标记位(ARMv5及以上),标记饱和算数指令是否已经达到饱和,或者在累加乘法中指令是否有符号溢出.</li>
<li>4个GE(大于等于)标记位(ARMv6及以上),用来标记一下情况:<br>(1) 有符号运算的结果是非负的<br>(2) 无符号运算是否产生进位或借位</li>
<li>2个中断标记位,一个是中断的类型(2个是在ARMv5版本及以下).</li>
<li>1个不确切中断标记位(ARMv6之后)</li>
<li>5个当前处理器所在模式标记位</li>
<li>2个指令集标记位,标记当前执行的是指令集是ARM,Thumb还是Jazelle</li>
<li>1个load/store操作的字节顺序标记位</li>
</ul>
<p>每个异常模式有一个SPSR寄存器(Saved Program Status Register),进入异常前保存任务的CPSR值.这两个寄存器以特殊的指令存取.</p>
<p><strong>Table A1-1 Status register summary</strong></p>
<table>
<thead>
<tr>
<th>Field</th>
<th>Description</th>
<th>Architecture</th>
</tr>
</thead>
<tbody>
<tr>
<td>N Z C V</td>
<td>Condition code flags</td>
<td>All</td>
</tr>
<tr>
<td>J</td>
<td>Jazelle state flag</td>
<td>5TEJ and above</td>
</tr>
<tr>
<td>GE[3:0]</td>
<td>SIMD condition</td>
<td>flags 6</td>
</tr>
<tr>
<td>E</td>
<td>Endian Load/Store</td>
<td>6</td>
</tr>
<tr>
<td>A</td>
<td>Imprecise Abort Mask</td>
<td>6</td>
</tr>
<tr>
<td>I</td>
<td>IRQ Interrupt Mask</td>
<td>All</td>
</tr>
<tr>
<td>F</td>
<td>FIQ Interrupt Mask</td>
<td>All</td>
</tr>
<tr>
<td>T</td>
<td>Thumb state flag</td>
<td>4T and above</td>
</tr>
<tr>
<td>Mode[4:0]</td>
<td>Processor mode</td>
<td>All</td>
</tr>
</tbody>
</table>

            
        
        </div>
        
            
            
    <hr class="copy-line">
    <div class="post-copyright">
        <div class="copy-author">
            <span>作者 :</span>
            <span>kiya</span>
        </div>
        <div class="copy-url">
            <span>地址 :</span>
            <a href="http://kiya.studio/2015/12/05/arm-introduction/">http://kiya.studio/2015/12/05/arm-introduction/</a>
        </div>
        <div class="copy-origin">
            <span>来源 :</span>
            <a href="http://kiya.studio">http://kiya.studio</a>
        </div>
        <div class="copy-license">
            
            著作权归作者所有，转载请联系作者获得授权。
        </div>
    </div>

        
    </article>
    
        
    <nav class="article-page">
        
            <a href="/2015/12/07/arm-instruction-exercises-1/" id="art-left" class="art-right">
                <span class="next-title">
                    arm指令练习篇章一<i class="iconfont icon-right"></i> 
                </span>
            </a>
        
        
            <a href="/2015/12/02/run-first-c-program-on-android-phone/" id="art-right" class="art-left">
                <span class="prev-title"> 
                    <i class="iconfont icon-left"></i>在android手机上运行C程序 - hello arm!
                </span>
            </a>
        
    </nav>

        
    


        </main>
        <footer class="footer syuanpi fadeIn" id="footer">
    <hr>
    <div class="footer-wrapper">
        <div class="left">
            <div class="contact-icon">
    
    
    
    
    
    
    
    
        
        
        
        
        
        
        
            <a href="https://www.instagram.com/kiyadayo" class="iconfont icon-ins" title="instagram"></a>
        
    
        
            <a href="https://github.com/kiya-z" class="iconfont icon-github" title="github"></a>
        
        
        
        
        
        
        
    
</div>
        </div>
        <div class="right">
            <div class="copyright">
    <div class="info">
        <span>&copy;</span>
        <span>2015 ~ 2017</span>
        <span>❤</span>
        <span>kiya</span>
    </div>
    <div class="theme">
        <span>
            动力来源于
            <a href="http://hexo.io/" target="_blank">Hexo </a>
        </span>
        <span>
            主题
            <a href="https://github.com/ColMugX/hexo-theme-Nlvi"> Nlvi </a>
        </span>
    </div>
    
</div>
        </div>
    </div>
</footer>
    </div>
    <script src="/script/nlvi.js"></script>
<script src="/script/search.js"></script>

    <script src="/lightbox/js/lightbox.min.js"></script>

<script>
$(document).ready(function(){
    document.body.addEventListener('touchstart', function () {});
    $('.progress').hide();
    $('.body').show();
    Nlvi.tagcloud();
    Nlvi.back2top();
    Nlvi.showToc();
    Nlvi.showComments();
    Nlvi.showReward();

    !CONFIG.animate && Nlvi.offAnimate();
    CONFIG.lightbox && Nlvi.onPicBox();
})
</script>
    </div>
    
        
    <div class="post-toc">
        <span class="title">文章目录</span>
        <div class="toc-inner syuanpi back-1 fallIn-light">
            <li class="title-link"><a href="javascript:;" class="toTop">Arm 架构简介</a></li>
            <ol class="toc"><li class="toc-item toc-level-1"><a class="toc-link" href="#A1-1-关于ARM-架构"><span class="toc-text">A1.1 关于ARM 架构</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#A1-1-1-ARM-寄存器"><span class="toc-text">A1.1.1  ARM 寄存器</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#A1-1-2-异常"><span class="toc-text">A1.1.2 异常</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#异常处理过程"><span class="toc-text">异常处理过程</span></a></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#A1-1-3-状态寄存器"><span class="toc-text">A1.1.3 状态寄存器</span></a></li></ol>
        </div>
    </div>

    
    <div class="backtop syuanpi dead toTop" id="backtop">
    <i class="iconfont icon-up"></i>
    <span style="text-align:center;font-family:Georgia;"><span style="font-family:Georgia;" id="scrollpercent">1</span>%</span>
</div>
    
</body>
</html>
